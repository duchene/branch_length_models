require(phangorn)
require(NELSI)
source("../../readIQ.R")
trs <- read.tree("../chrons.tre")
tr32 <- trs[[4]]

res <- matrix(NA, 4, 3)
rownames(res) <- c("topleft", "bottomright", "topright", "bottomleft")
colnames(res) <- c("shared", "pl", "ul")
ratogs32.1 <- list()
### Use log rate of log(0.01) and sd.log of 0.3. For mean rate (tree length) difference, perhaps of 0.001 (this difference can be mixed with among lineage rate variation of sd.log = 0.2)
for(i in 1:10) ratogs32.1[[i]] <- simulate.uncor.lnorm(tr32, params = list(mean.log = log(0.01), sd.log = 0.2))
for(i in 11:20) ratogs32.1[[i]] <- simulate.uncor.lnorm(tr32, params = list(mean.log = log(0.011), sd.log = 0.2))
al2.1 <- simSeq(ratogs32.1[[1]][[1]], l = 500)
al2.2 <- simSeq(ratogs32.1[[11]][[1]], l = 500)
al2 <- cbind(al2.1, al2.2)
write.dna(as.DNAbin(al2), format = "fasta", file = "al.32tax.10k.fasta")
system("~/Desktop/Software/iqtree-1.6.7-MacOSX/bin/iqtree -s al.32tax.10k.fasta -m TEST -bb 1000 -q ../part1000.nex -nt 2 -redo -pre 3_tl")
system("~/Desktop/Software/iqtree-1.6.7-MacOSX/bin/iqtree -s al.32tax.10k.fasta -m TEST -bb 1000 -spp ../part1000.nex -nt 2 -redo -pre 5_tl")
system("~/Desktop/Software/iqtree-1.6.7-MacOSX/bin/iqtree -s al.32tax.10k.fasta -m TEST -bb 1000 -sp ../part1000.nex -nt 2 -redo -pre 7_tl")
res[1,1] <- readIQ("3_tl.iqtree")$stats["bic"]
res[1,2] <- readIQ("5_tl.iqtree")$stats["bic"]
res[1,3] <- readIQ("7_tl.iqtree")$stats["bic"]

ratogs4.1 <- ratogs32.1
for(i in 1:20) ratogs4.1[[i]] <- drop.tip(ratogs32.1[[i]][[1]], paste0("t", 5:32))
al1.1 <- simSeq(ratogs4.1[[1]], l = 5000)
al1.2 <- simSeq(ratogs4.1[[11]], l = 5000)
al1 <- cbind(al1.1, al1.2)
write.dna(as.DNAbin(al1), format = "fasta", file = "al.4tax.10k.fasta")
system("~/Desktop/Software/iqtree-1.6.7-MacOSX/bin/iqtree -s al.4tax.10k.fasta -m TEST -bb 1000 -q ../part10000.nex -nt 2 -redo -pre 3_br")
system("~/Desktop/Software/iqtree-1.6.7-MacOSX/bin/iqtree -s al.4tax.10k.fasta -m TEST -bb 1000 -spp ../part10000.nex -nt 2 -redo -pre 5_br")
system("~/Desktop/Software/iqtree-1.6.7-MacOSX/bin/iqtree -s al.4tax.10k.fasta -m TEST -bb 1000 -sp ../part10000.nex -nt 2 -redo -pre 7_br")
res[2,1] <- readIQ("3_br.iqtree")$stats["bic"]
res[2,2] <- readIQ("5_br.iqtree")$stats["bic"]
res[2,3] <- readIQ("7_br.iqtree")$stats["bic"]

al2.1 <- simSeq(ratogs32.1[[1]][[1]], l = 5000)
al2.2 <- simSeq(ratogs32.1[[11]][[1]], l = 5000)
al2 <- cbind(al2.1, al2.2)
write.dna(as.DNAbin(al2), format = "fasta", file = "al.32tax.10k.fasta")
system("~/Desktop/Software/iqtree-1.6.7-MacOSX/bin/iqtree -s al.32tax.10k.fasta -m TEST -bb 1000 -q ../part10000.nex -nt 2 -redo -pre 3_tr")
system("~/Desktop/Software/iqtree-1.6.7-MacOSX/bin/iqtree -s al.32tax.10k.fasta -m TEST -bb 1000 -spp ../part10000.nex -nt 2 -redo -pre 5_tr")
system("~/Desktop/Software/iqtree-1.6.7-MacOSX/bin/iqtree -s al.32tax.10k.fasta -m TEST -bb 1000 -sp ../part10000.nex -nt 2 -redo -pre 7_tr")
res[3,1] <- readIQ("3_tr.iqtree")$stats["bic"]
res[3,2] <- readIQ("5_tr.iqtree")$stats["bic"]
res[3,3] <- readIQ("7_tr.iqtree")$stats["bic"]

ratogs4.1 <- ratogs32.1
for(i in 1:20) ratogs4.1[[i]] <- drop.tip(ratogs32.1[[i]][[1]], paste0("t", 5:32))
al1.1 <- simSeq(ratogs4.1[[1]], l = 500)
al1.2 <- simSeq(ratogs4.1[[11]], l = 500)
al1 <- cbind(al1.1, al1.2)
write.dna(as.DNAbin(al1), format = "fasta", file = "al.4tax.10k.fasta")
system("~/Desktop/Software/iqtree-1.6.7-MacOSX/bin/iqtree -s al.4tax.10k.fasta -m TEST -bb 1000 -q ../part1000.nex -nt 2 -redo -pre 3_bl")
system("~/Desktop/Software/iqtree-1.6.7-MacOSX/bin/iqtree -s al.4tax.10k.fasta -m TEST -bb 1000 -spp ../part1000.nex -nt 2 -redo -pre 5_bl")
system("~/Desktop/Software/iqtree-1.6.7-MacOSX/bin/iqtree -s al.4tax.10k.fasta -m TEST -bb 1000 -sp ../part1000.nex -nt 2 -redo -pre 7_bl")
res[4,1] <- readIQ("3_bl.iqtree")$stats["bic"]
res[4,2] <- readIQ("5_bl.iqtree")$stats["bic"]
res[4,3] <- readIQ("7_bl.iqtree")$stats["bic"]

system("rm 3_*")
system("rm 5_*")
system("rm 7_*")

